// import 'dotenv/config';
import React, {useState, useEffect, useRef} from 'react';
import {
  View,
  Text,
  TextInput,
  Button,
  StyleSheet,
  ScrollView,
  ActivityIndicator,
  KeyboardAvoidingView,
  Platform,
  Keyboard,
  TouchableOpacity,
  Image,
  Animated,
} from 'react-native';
import {WaveIndicator} from 'react-native-indicators';
import {KeyboardAwareScrollView} from 'react-native-keyboard-aware-scroll-view';

import {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} from '@google/generative-ai';

const MODEL_NAME = 'gemini-pro';
const API_KEY = 'AIzaSyBH0VbYh434e3Qbdwb3A0eERwCkV7Qy5Ng';

const MultiModal = () => {
  const [showConversation, setShowConversation] = useState(false);
  const [userInput, setUserInput] = useState('');
  const [conversation, setConversation] = useState([
    {
      role: 'user',
      parts: [
        {
          text: 'your are gonna help students in their studies\n\n\ngive easy explationation to the question\nadd very simple example, or code snippet, whatever is necessary that should be a real-life easy example \n\nso that even a below-average student can grasp the examples easily \n\n dont use ** instead use points numbering',
        },
      ],
    },
    {
      role: 'model',
      parts: [
        {
          text: '**Question**: What is the difference between a variable and a constant?\n\n**Easy Explanation**:\n\n* **Variable**: A variable is like a container that can store different values. You can think of it like a box that you can put things in and take things out of.\n* **Constant**: A constant is like a value that never changes. You can think of it like a number that is written in stone.\n\n**Example**:\n\n* **Variable**: Imagine you have a box that you use to store your toys. You can put different toys in the box, and you can take them out whenever you want to play with them. The box is the variable, and the toys are the values that you store in the box.\n* **Constant**: Imagine you have a number, like the number 5. You can\'t change the number 5. It\'s a constant value.\n\n**Code Snippet**:\n\n```python\n# Variable\nmy_name = "John Smith"\n\n# Constant\nPI = 3.14159\n```\n\nIn this example, `my_name` is a variable that can store different values, such as "John Smith" or "Jane Doe". `PI` is a constant that stores the value of Pi, which is approximately 3.14159.',
        },
      ],
    },
  ]);
  const [loading, setLoading] = useState(false);
  const [isButtonDisabled, setButtonDisabled] = useState(true);
  const [color, setColor] = useState('teal');
  const [showLoader, setShowLoader] = useState(false);
  // eslint-disable-next-line react-hooks/exhaustive-deps
  const placeholders = [
    'Artificial Intelligence and Machine Learning',
    'Cybersecurity and Ethical Hacking',
    'Data Science and Big Data Analytics',
    'Quantum Computing',
    'Genetics and Genetic Engineering',
    'Ecology and Environmental Science',
    'Human Anatomy and Physiology',
    'Microbiology and Immunology',
    'Biochemistry',
    'World Wars I and II',
    'Renaissance and Scientific Revolution',
    'Cold War Era',
    'Industrial Revolution',
  ];
  const [selectedPlaceholder, setSelectedPlaceholder] = useState('');
  useEffect(() => {
    // Randomly select a placeholder when the component mounts
    const randomIndex = Math.floor(Math.random() * placeholders.length);
    setSelectedPlaceholder(placeholders[randomIndex]);
  }, []);

  useEffect(() => {
    const id = setInterval(() => {
      setColor(color => (color == 'teal' ? 'red' : 'teal'));
    }, 400);
    return () => clearInterval(id);
  }, []);

  useEffect(() => {
    // Enable the button only when there is user input
    setButtonDisabled(userInput.trim() === '');
  }, [userInput]);

  const handleGenerateResponse = async () => {
    Keyboard.dismiss();
    setLoading(true);
    setShowLoader(true);

    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({model: MODEL_NAME});

    const generationConfig = {
      temperature: 0.75,
      topK: 1,
      topP: 1,
      maxOutputTokens: 2048,
    };

    const safetySettings = [
      {
        category: HarmCategory.HARM_CATEGORY_HARASSMENT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
    ];

    const chat = model.startChat({
      generationConfig,
      safetySettings,
      history: conversation,
    });

    const result = await chat.sendMessage(userInput);
    const response = result.response;
    console.log('Raw Text:', response.text());

    if (!result.isBlocked) {
      setConversation(prevConversation => [
        ...prevConversation,
        {role: 'user', parts: [{text: userInput}]},
        {role: 'model', parts: [{text: response.text()}]},
      ]);
    }

    setUserInput('');
    setLoading(false);
    setButtonDisabled(true);
    setShowConversation(true);
    setShowLoader(false);
  };

  const formatMessageText = text => {
    let formattedText = text;

    // Bold and italic: **text**
    formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, (match, p1) => {
      return (
        <Text style={{fontWeight: 'normal', fontStyle: 'italic'}}>{p1}</Text>
      );
    });

    // Bold: *text*
    formattedText = formattedText.replace(/\*(.*?)\*/g, (match, p1) => {
      return <Text style={{fontWeight: 'bold', color: 'red'}}>{p1}</Text>;
    });

    // Bold and italic: ```text```
    formattedText = formattedText.replace(/```(.*?)```/g, (match, p1) => {
      return (
        <Text
          style={{fontWeight: 'bold', fontStyle: 'italic', color: 'purple'}}>
          {p1}
        </Text>
      );
    });

    return <Text>{formattedText}</Text>;
  };

  return (
    <KeyboardAvoidingView
      behavior="padding"
      keyboardVerticalOffset={Platform.OS === 'ios' ? 100 : 0}
      style={styles.container}>
      <ScrollView
        contentContainerStyle={styles.scrollViewContent}
        keyboardShouldPersistTaps="handled">
        <View style={styles.chatSnippets}>
          {showConversation &&
            conversation.slice(2).map((message, index) => (
              <View
                key={index}
                style={[
                  styles.messageContainer,
                  message.role === 'user'
                    ? styles.userMessage
                    : styles.modelMessage,
                ]}>
                {formatMessageText(message.parts[0].text)}
              </View>
            ))}
        </View>
      </ScrollView>
      <View style={styles.inputTouchapleWrapper}>
        <View style={styles.inputLoadingWrapper}>
          <TextInput
            style={styles.input}
            placeholder={selectedPlaceholder}
            value={userInput}
            onChangeText={text => setUserInput(text)}
          />
          {showLoader && (
            <WaveIndicator
              size={59}
              color={'#3B3A3F'}
              style={styles.loading}
              count={5}
              waveFactor={0.6}
            />
          )}
          {!showLoader && (
            <TouchableOpacity
              style={styles.GenerateButton}
              onPress={handleGenerateResponse}
              disabled={isButtonDisabled || loading}>
              <Image
                source={require('./images/send.png')} // Replace with your image path
                style={styles.generateButtonImage}
              />
            </TouchableOpacity>
          )}
        </View>
        {/* <Button /> */}
      </View>
    </KeyboardAvoidingView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    // paddingBottom: 200,
    // margin: 10,
    backgroundColor: '#3B3A3F',
    // borderColor: 'gold',
    // borderWidth: 4,
  },
  scrollViewContent: {
    flexGrow: 1,
    // justifyContent: 'flex-end',
  },
  chatSnippets: {
    margin: 15,
  },
  messageContainer: {
    borderRadius: 8,
    padding: 13,
    maxWidth: '88%',
    marginVertical: 8,
    // padding: 12,
    color: 'black',
    backgroundColor: '#BAFF2A',

    // model message
  },
  userMessage: {
    alignSelf: 'flex-end',
    backgroundColor: '#BAFF2A',
    color: 'black',
  },
  modelMessage: {
    alignSelf: 'flex-start',
    // backgroundColor: '#0D9276',
  },
  messageText: {
    // color: '#BAFF2A',
    color: 'black',
  },
  inputTouchapleWrapper: {
    backgroundColor: 'rgb(25,25,25)',
    // opacity: 0.95,

    paddingVertical: 20,
    paddingHorizontal: 16,
    borderTopLeftRadius: 20,
    borderTopRightRadius: 20,
    // alignSelf: 'flex-end',
    // flex: 1,

    justifyContent: 'space-evenly',
  },
  inputLoadingWrapper: {
    flexDirection: 'row',
    justifyContent: 'center',
    alignItems: 'center',
    // marginRight: 5,
    // alignItems: 'center', // Add this line
    // justifyContent: 'space-between', // Add this line
    // paddingHorizontal: 16,
  },
  input: {
    borderRadius: 35,
    paddingHorizontal: 18,
    // padding:8,
    width: '30%',
    flexWrap: 'wrap',
    flex: 1,
    height: 55,

    marginRight: 2,
    // borderColor: '#ccc',
    // borderWidth: 1,
    // borderRadius: 8,
    // marginVertical: 10,
    // padding: 10,
    backgroundColor: '#3B3A3F',
    // color: 'red',
  },

  loading: {
    margin: -120,
    // count: 5,
    // flex: 1,
    // marginHorizontal: 4,
  },
  GenerateButton: {
    // height: 40,
    // width: 150,
    backgroundColor: '#3B3A3F',
    borderRadius: 50,

    alignItems: 'center',
    justifyContent: 'center',
    padding: 12,
    margin: 6,
    // borderColor: 'green',
    // borderWidth: 3,
    // borderRadius: 20,
  },
  generateButtonImage: {
    width: 30,
    height: 30,
    // fontSize: 18,
    // fontWeight: 'bold',
  },
});

export default MultiModal;

correct the if else statement

sentence wrapped with ** must be bold 
sentence wrapped with * must be noraml
and sentence wrapped with ``` must be bold and italic




i want a component to be displayed in the center of the screen 
which initaly comes has some welcome text and when the user presses the button it 